Доклад: Вебхуки. зачем их есть?

-слайд 1
REST(Representational State Transfer) API, не будем углубляться, есть ещё GraphQL, RPC от гугла, и т.д.
Давайте поговорим про REST, не является официальным стандартом - скорее, это набор предложений о том, как разрабатывать API и другие веб-службы, если мы хотим с какого либо сайта, получить данные и что то с ними сделать и большинство сайтов это делают, допустим мы можем через REST получать погоду и как то её у себя уже красиво представлять и т.д.
REST не только может получать информацию, верно, так же можно и передавать на сервер новые данные, или же изменять или и вовсе удалять 
-слайд 2
CRUD - create, read, update, delete
Но есть проблема, данные мы получаем только когда делаем запрос, то есть если допустим пришло сообщение, мы о нем не узнаем пока не запросим список сообщений, когда можно немного извращений, о которых чуть позже =)
по этому появился Webhooks
-слайд 3
API - программный интерфейс приложения
Веб-хук можно рассматривать как тип API, который управляется событиями, а не запросами. Вместо того, чтобы одно приложение отправляло запрос другому на получение ответа, или же - это служба, которая позволяет одной программе отправлять данные другой, как только происходит определенное событие. Веб-перехватчики иногда называют «обратными API-интерфейсами», поскольку связь инициируется приложением, отправляющим данные, а не получающим их.
-слайд 4
На примерах, смотри как работает REST, в этом случае если нам нужно получить что то новое, клиент постоянно запрашивает информацию или же делает polling
-слайд 5
А в случае с веб-хуком, сервер ему такой, "Эй смотри, тут данные для тебя", а клиент радостно благодарит
-слайд 6
Теперь реальный пример, я приведу его исходя из недавнего опыта создания телеграм бота, а если быть точнее модуля который отвечает за оповещения из гитлаба
Как то вечером пришла мысль, что хотелось бы в телегу получать уведомления о состоянии issue или merge requests, а не проверять почту или обновлять страницу в гитлабе без необходимости
Первым же делом я полез в документацию Gitlab API, даже не думая о чем либо, ох сколько же там костылей, если коротко
-слайд 7
При инициализации бота я делал первый запрос и записывал полученные данные в массив 1 и хранил его
затем каждые пару секунд я делал новый запрос и записывал во второй массив, затем сравнивал эти два массива и прогонял его по условиям
В чем тут проблема? приходится каждые 1-2 секунды делать запрос, а потом ещё полученный массив сравнивать между собой, который не очень то приятный, и что бы понять новый это ишью или что либо ещё нужно много проверок
Тогда я начал искать варианты, и где то слышал про существование вебхуков, так что решил почитать, что и как
и это решение, Gitlab прекрасно работает с issue, не могу того же сказать про merge request, он не хочет отдавать некоторые нужные мне поля, так что я завёл issue в проекте гитлаба и жду ответа
-слайд 8
Реализация достаточно простая
Нужно поднять простенький сервер, я его поднял на NodeJS и написал небольшой модуль слушателя гитлаба и попросил его слушать адрес tgbot.desync.ru/tg, а затем всё как по маслу, при создании или изменений ишью гитлаб генерирует событие и шлет его на наш адрес, а там уже полученный евент я обрабатываю так как мне нужно
-слайд 9
это лишь простой пример использования данной технологии, а если задуматься, применений может найтись множество, особенно учитывая нашу экосистему продуктов, то можно легко найти применение вебхукам
-слайд 10
!Безопасность использования вебхуков
Конечно возникает проблема что адрес ендпоинта публичный и любой может отправить поддельный запрос или же перехватить данные, для этого стоит использовать 
-слайд 11
1) HTTPS
-слайд 12
2) уникальный идентификатор, секретный ключ, по которому запрос будет аутентифицирова
-слайд 13
3) Не доверять данным которые приходят, что это значит? Специалисты советуют использовать webhook в связке и ловить ивент который будет уже запрашивать данные по REST API
-слайд 12
что могу посоветовать для начала работы с вебхуками
1) https://webhook.site/ - позволяет получить ендпоинт, что бы можно было отлавливать и проверить в целом работоспособность хука
2) https://pipedream.com/requestbin - почти аналог, но чуть более многофункциональней
3) http://getpostman.com/ - конечно же постман
4) https://ngrok.com/ - если хотите тестить локально